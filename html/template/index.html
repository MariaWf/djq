<html>
<head>
    <script src="/static/js/test.js"></script>
    <link href="/static/css/test.css" rel="stylesheet">
    <!--<script src="/static/js/jquery-2.1.1.min.js"></script>-->
    <script src="http://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="/static/js/jsencrypt.min.js"></script>

</head>
<body>
index
<div id="myDiv"><h2>Let AJAX change this text</h2></div>
<button id="b01" type="button">Change Content</button>

<form enctype="multipart/form-data" method="post" id="uploadForm">
    <input type="file" name="theFile" accept="image/gif, image/jpeg, image/png"/>
    <input type="text" name="wawaName" value="文件名称"/>
    <button id="b02" type="button">upload</button>
</form>

<div>
    <button type="button" onclick="findAdmin()">findAdmin</button>
</div>
<textarea id="resultMsg" style="width:400px;height:100px"></textarea>

<div>
    <button type="button" onclick="getPublicKey()">获取公匙</button>

    <form enctype="multipart/form-data" method="post" action="http://localhost:8080/mi/login">
    <input type="text" id="loginName" name="name" value="" placeholder="登录名称"/>
    <input type="text" id="password" name="password" value="" placeholder="登录密码"/>
    <button type="button" onclick="login()">登录</button>
    <button type="button" onclick="logout()">登出</button>
        <input type="submit" value="submit" />
    </form>
</div>
</body>
<script>
    if (getCookie("miSessionId")){
        $("#resultMsg").val(getCookie("miSessionId"))
    }
    function getPublicKey(){
        obj = {}
        $.ajax({
            type: 'GET',
            url: "http://localhost:8080/getPublicKey",
            data: obj,
            dataType: "json",
            success: function (data) {
                if (data.status == 1) {
                    $("#resultMsg").val(data.result)
                } else {
                    $("#resultMsg").val(data.msg)
                }
            },
            error: function (data) {
                $("#resultMsg").val(data.msg)
            },
            complete: function (data) {
//                $("#resultMsg").val(data)
            }
        });
    }
    function login() {
        obj = {}
        obj.name = $("#loginName").val()
        obj.password = $("#password").val()

        var encrypt = new JSEncrypt();
        encrypt.setPublicKey($('#resultMsg').val());
        obj.password  = encrypt.encrypt(obj.password);
        $.ajax({
            type: 'POST',
            url: "http://localhost:8080/mi/login",
            data: obj,
//            data: {name:obj.name,password:obj.password},
//            async: true,
//            cache: false,
            dataType: "json",
//            contentType: false,
//            processData: false,
            success: function (data) {
                if (data.status == 1) {
                    $("#resultMsg").val(data.result.name + getCookie("miSessionId"))
                } else {
                    $("#resultMsg").val(data.msg)
                }
            },
            error: function (data) {
                $("#resultMsg").val(data.msg)
            },
            complete: function (data) {
//                $("#resultMsg").val(data)
            }
        });
    }
    function logout() {
        obj = {}
        obj.name = $("#loginName").val()
        obj.password = $("#password").val()
        $.ajax({
            type: 'POST',
            url: "http://localhost:8080/mi/logout",
            data: obj,
            async: true,
            cache: false,
            dataType: "json",
            contentType: false,
            processData: false,
            success: function (data) {
                if (data.status == 1) {
                    $("#resultMsg").val(getCookie("miSessionId"))
                } else {
                    $("#resultMsg").val(data.msg)
                }
            },
            error: function (data) {
                $("#resultMsg").val(data.msg)
            },
            complete: function (data) {
//                $("#resultMsg").val(data)
            }
        });

    }
    function findAdmin() {
        $.ajax({
            type: 'GET',
            url: "http://localhost:8080/mi/admin/?name=mimi&targetPage=2&pageSize=2",
//                data: formData,
            async: true,
            cache: false,
            dataType: "json",
            contentType: false,
            processData: false,
//            withCredentials: true,
            success: function (data) {
                $("#resultMsg").val(data.status)
            },
            error: function (data) {
                $("#resultMsg").val(data)
            },
            complete: function (data) {
//                $("#resultMsg").val(data)
            }
        });
    }

    $(function () {
        $("#b01").click(function () {
//            htmlobj = $.ajax({url: "http://api.djq.tunnel.qydev.com/user", async: false});
//
//            $("#myDiv").html(htmlobj.responseText);

            var formData = {
                id: "id1",
                name: "name1",
                description: "",
                contentUrl: "",
                preImageUrl: "",
                secondHandHouseId: ""
            };
            $.ajax({
                type: 'GET',
                url: "http://djq.tunnel.qydev.com/user/dd",
//                data: formData,
                async: true,
                cache: false,
                dataType: "json",
                contentType: false,
                processData: false,
                success: function (data) {
                    $("#myDiv").html(data.status)
                },
                error: function (data) {
                },
                complete: function () {
                    alert(getCookie("test"))
                }
            });
        });

        $("#b02").click(function () {
            var formData = new FormData($("#uploadForm")[0]);
            $.ajax({
                type: 'POST',
                url: "http://djq.tunnel.qydev.com/upload",
                data: formData,
                async: true,
                cache: false,
                dataType: "json",
                contentType: false,
                processData: false,
                success: function (data) {
                    if (data.status) {
                        alert(data.result)
                    } else {
                        alert(data.msg);
                    }
                },
                error: function (data) {
                    alert("上传失败");
                },
                complete: function () {
                }
            });
        })


    })
    function getCookie(name) {
        var arr, reg = new RegExp("(^| )" + name + "=([^;]*)(;|$)");
        if (arr = document.cookie.match(reg))
            return unescape(arr[2]);
        else
            return null;
    }
</script>
</html>